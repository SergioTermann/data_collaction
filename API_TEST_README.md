# API测试工具使用说明

## 概述

`test_api.py` 是一个全面的API测试工具，用于验证PDF处理和智谱AI功能是否正常工作。

## 功能特性

### 🔧 环境配置测试
- 检查 `.env` 文件是否存在
- 验证 `ZHIPU_API_KEY` 是否正确加载
- 显示Python版本和当前工作目录

### 🤖 智谱AI接口测试
- 测试API连接是否正常
- 验证文本总结功能
- 验证关键概念提取功能
- 测量API响应时间

### 📚 PDF读取功能测试
- 自动查找项目中的PDF文件
- 测试PDF页数获取
- 测试PDF内容读取
- 显示读取性能指标

### 📋 PDF摘要功能测试
- 测试完整的PDF摘要生成流程
- 验证摘要和关键概念提取
- 测量处理时间和性能

### 🛡️ 错误处理测试
- 测试无效API密钥处理
- 测试不存在文件的处理
- 测试空参数的处理

## 使用方法

### 1. 运行完整测试
```bash
python test_api.py
```
或
```bash
python test_api.py --test all
```

### 2. 运行特定测试

#### 测试环境配置
```bash
python test_api.py --test env
```

#### 测试智谱AI接口
```bash
python test_api.py --test zhipu
```

#### 测试PDF读取功能
```bash
python test_api.py --test pdf
```

#### 测试PDF摘要功能
```bash
python test_api.py --test summarizer
```

#### 测试错误处理
```bash
python test_api.py --test error
```

## 准备工作

### 1. 环境变量设置
确保 `.env` 文件中包含有效的智谱AI API密钥：
```
ZHIPU_API_KEY=your_api_key_here
```

### 2. 测试文件准备
- 在项目目录中放置至少一个PDF文件用于测试
- 确保PDF文件可读且包含文本内容

### 3. 依赖检查
确保已安装所有必要的依赖：
```bash
pip install -r requirements.txt
```

## 测试输出说明

### 状态图标
- ✅ 测试通过
- ❌ 测试失败
- ⚠️ 警告（功能可能受限但不影响核心功能）
- 🔄 正在处理
- 📊 统计信息
- 💡 建议

### 测试报告
测试完成后会显示：
- 各项测试的通过/失败状态
- 总体通过率
- 总测试时间
- 针对失败项目的改进建议

## 常见问题

### Q: 提示"API密钥未设置"
**A:** 检查 `.env` 文件是否存在且包含正确的 `ZHIPU_API_KEY`

### Q: 提示"未找到PDF文件"
**A:** 在项目目录中放置至少一个PDF文件

### Q: 智谱AI测试失败
**A:** 
1. 检查网络连接
2. 验证API密钥是否有效
3. 确认API配额是否充足

### Q: PDF读取失败
**A:**
1. 确认PDF文件未损坏
2. 检查文件权限
3. 确认PDF包含可提取的文本内容

## 性能基准

### 正常性能指标
- 智谱AI响应时间：通常 2-10 秒
- PDF读取时间：通常 < 1 秒（取决于文件大小）
- PDF摘要生成：通常 10-30 秒（取决于内容长度）

### 优化建议
- 对于大型PDF文件，考虑分页处理
- 网络较慢时，可能需要增加超时时间
- 频繁测试时注意API调用限制

## 扩展功能

你可以根据需要扩展测试功能：

1. **添加新的测试用例**：在 `APITester` 类中添加新的测试方法
2. **自定义测试参数**：修改测试参数以适应特定需求
3. **集成到CI/CD**：将测试脚本集成到自动化流程中

## 技术支持

如果遇到问题：
1. 查看测试输出中的详细错误信息
2. 检查项目依赖是否完整
3. 确认环境配置是否正确
4. 查看相关模块的文档说明